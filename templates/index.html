<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Spelling Bee Practice</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <h1>Spelling Bee Practice</h1>
    <button id="startPractice">Start Practice</button>
    <p id="wordPrompt"></p>
    <p id="userResponse"></p>
    <p id="feedback"></p>
    <p id="continuePrompt"></p>
    <button id="continuePractice" style="display:none;">Continue Practice</button>

    <script>
        function startPractice() {
            fetch('/get_word')
                .then(response => response.json())
                .then(data => {
                    const word = data.word;
                    document.getElementById('wordPrompt').textContent = 'Spell the word: ' + word;

                    // Use TTS to say the word
                    const wordUtterance = new SpeechSynthesisUtterance(word);
                    window.speechSynthesis.speak(wordUtterance);

                    // Speech recognition for user's response
                    const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
                    recognition.lang = 'en-US';
                    recognition.interimResults = false;
                    recognition.maxAlternatives = 1;

                    recognition.start();

                    recognition.onresult = (event) => {
                        const userSpelling = event.results[0][0].transcript;
                        document.getElementById('userResponse').textContent = 'You spelled: ' + userSpelling;

                        // Normalize and compare spelling
                        const normalizedUserSpelling = userSpelling.replace(/\s+/g, '').toLowerCase();
                        const normalizedWord = word.replace(/\s+/g, '').toLowerCase();

                        let feedbackText;
                        if (normalizedUserSpelling === normalizedWord) {
                            feedbackText = 'Correct!';
                        } else {
                            feedbackText = 'Incorrect. The correct spelling is ' + word + '.';
                        }

                        document.getElementById('feedback').textContent = feedbackText;

                        // Use TTS to provide feedback
                        const feedbackUtterance = new SpeechSynthesisUtterance(feedbackText);
                        window.speechSynthesis.speak(feedbackUtterance);

                        // Ask if the user wants to continue
                        document.getElementById('continuePrompt').textContent = 'Would you like to continue the practice?';
                        document.getElementById('continuePractice').style.display = 'inline';
                    };

                    recognition.onspeechend = () => {
                        recognition.stop();
                    };

                    recognition.onerror = (event) => {
                        document.getElementById('feedback').textContent = 'Error occurred in recognition: ' + event.error;
                    };
                });
        }

        document.getElementById('startPractice').addEventListener('click', function() {
            document.getElementById('continuePrompt').textContent = '';
            document.getElementById('continuePractice').style.display = 'none';
            startPractice();
        });

        document.getElementById('continuePractice').addEventListener('click', function() {
            document.getElementById('continuePrompt').textContent = '';
            document.getElementById('continuePractice').style.display = 'none';
            startPractice();
        });
    </script>
</body>
</html>
